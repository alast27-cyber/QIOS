<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHIPS:// Browser & Quantum Node</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #0f172a; color: #e5e7eb; }
        .grid-container { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        .console { background-color: #1e293b; font-family: monospace; height: 200px; overflow-y: auto; border-radius: 0.5rem; padding: 1rem; }
        .btn { background: #3b82f6; color: white; border: none; padding: 0.6rem 1.2rem; border-radius: 8px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; }
        .btn:disabled { background: #4b5563; cursor: not-allowed; }
        canvas { background-color: #1e293b; border: 1px solid #334155; border-radius: 0.75rem; display: block; }
    </style>
</head>
<body class="p-6">
    <div class="max-w-7xl mx-auto space-y-6">
        <header>
            <h1 class="text-3xl font-bold">CHIPS:// Browser & Quantum Node</h1>
            <p id="connection-status" class="text-xl mt-2 font-semibold text-red-500">Connecting to Back Office...</p>
        </header>

        <div class="grid-container">
            <!-- Left Column: Game -->
            <div class="space-y-4">
                <section>
                    <h2 class="text-xl font-semibold mb-3">Quantum Competitive Snake</h2>
                    <canvas id="gameCanvas" width="400" height="400"></canvas>
                    <div class="mt-4 flex flex-col space-y-2">
                        <button id="findGameBtn" class="btn bg-green-600 w-full">Find Human Opponent (PVP)</button>
                        <button id="findAIBtn" class="btn bg-cyan-600 w-full">Play against Guardian AI (PVA)</button>
                    </div>
                </section>
            </div>

            <!-- Right Column: Log and Scoreboard -->
            <div class="space-y-6">
                <section>
                    <h2 class="text-xl font-semibold mb-3">Scoreboard</h2>
                    <div class="bg-gray-800 p-4 rounded-lg text-center">
                        <p class="text-2xl"><span class="text-cyan-400">You:</span> <span id="myScore">0</span></p>
                        <p class="text-2xl"><span class="text-pink-400">Opponent:</span> <span id="opponentScore">0</span></p>
                    </div>
                </section>
                <section>
                    <h2 class="text-xl font-semibold mb-3">Node Log</h2>
                    <div id="nodeLog" class="console"></div>
                </section>
            </div>
        </div>
    </div>

<script>
    const nodeLog = document.getElementById('nodeLog');
    const connectionStatus = document.getElementById('connection-status');
    const findGameBtn = document.getElementById('findGameBtn');
    const findAIBtn = document.getElementById('findAIBtn'); // New button
    const gameCanvas = document.getElementById('gameCanvas');
    const ctx = gameCanvas.getContext('2d');
    const myScoreEl = document.getElementById('myScore');
    const opponentScoreEl = document.getElementById('opponentScore');
    
    const socket = io("https://qios-2.onrender.com", { transports: ['websocket'] });
    let myId = null;
    let partnerId = null;

    function log(m, t='info'){ /* ... same as before ... */ }
    socket.on('connect', () => { myId = socket.id; /* ... same as before ... */ });
    // --- All other socket listeners and game logic are IDENTICAL to the previous version ---

    // --- NEW Button Event Listener ---
    findAIBtn.addEventListener('click', () => {
        log('Requesting a game against the Guardian AI...', 'info');
        findGameBtn.disabled = true;
        findAIBtn.disabled = true;
        findAIBtn.textContent = "Connecting to AI...";
        socket.emit('find_ai_game');
    });

    findGameBtn.addEventListener('click', () => {
        log('Finding a human opponent...', 'info');
        findGameBtn.disabled = true;
        findAIBtn.disabled = true;
        findGameBtn.textContent = "Searching...";
        socket.emit('find_game');
    });

    function startGame() {
        // ... (same as before, but update both buttons)
        findGameBtn.disabled = true; findGameBtn.textContent = "Game in Progress...";
        findAIBtn.disabled = true; findAIBtn.textContent = "Game in Progress...";
        // ... (rest is the same)
    }

    function endGame(notifyServer = false) {
        // ... (same as before, but update both buttons)
        if (isGameOver) return;
        isGameOver = true;
        clearInterval(gameLoop);
        log('Game Over!', 'error');
        if (notifyServer) socket.emit('game_over');
        findGameBtn.disabled = false; findGameBtn.textContent = "Find Human Opponent (PVP)";
        findAIBtn.disabled = false; findAIBtn.textContent = "Play against Guardian AI (PVA)";
    }
    
    // --- PASTE THE REST of the UNCHANGED JAVASCRIPT LOGIC HERE ---
    // This includes: log, socket.on('connect'), on('ping'), on('disconnect'), on('log_message'),
    // the entire snake game logic (draw, update, etc.),
    // and the competitive game event listeners (on('game_start'), on('new_fruit'), etc.)
    // For brevity, it's omitted, but in your final file, you would have the full script.
</script>
</body>
</html>
